<!DOCTYPE html>
<html>
<head>
    <title>Debug Network Interfaces</title>
</head>
<body>
    <h1>Network Interface Debug</h1>
    <select id="interfaceSelect"></select>
    <div id="debug-output"></div>
    
    <script>
        const API_BASE = '/api';
        let currentApiKey = null;
        
        function debugLog(message) {
            const output = document.getElementById('debug-output');
            const div = document.createElement('div');
            div.textContent = new Date().toISOString() + ': ' + message;
            output.appendChild(div);
            console.log(message);
        }
        
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                debugLog(`Making API call to: ${API_BASE + endpoint}`);
                
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                // Add API key to headers if available
                if (currentApiKey) {
                    options.headers['X-API-Key'] = currentApiKey;
                    debugLog('API key added to headers');
                } else {
                    debugLog('No API key - making request without authentication');
                }
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(API_BASE + endpoint, options);
                debugLog(`Response status: ${response.status}`);
                
                const result = await response.json();
                debugLog(`Response data: ${JSON.stringify(result)}`);
                
                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Invalid or missing API key');
                    }
                    throw new Error(result.error || 'API request failed');
                }
                
                return result;
            } catch (error) {
                debugLog(`API Error: ${error.message}`);
                throw error;
            }
        }
        
        async function loadInterfaces() {
            debugLog('Starting loadInterfaces function');
            try {
                const data = await apiCall('/network/interfaces');
                debugLog(`Received interfaces data: ${JSON.stringify(data)}`);
                
                const interfaces = data.interfaces || [];
                debugLog(`Number of interfaces: ${interfaces.length}`);
                
                const select = document.getElementById('interfaceSelect');
                if (!select) {
                    debugLog('ERROR: interfaceSelect element not found!');
                    return;
                }
                
                debugLog('Clearing select options');
                select.innerHTML = '';
                
                interfaces.forEach((iface, index) => {
                    debugLog(`Processing interface ${index}: ${iface.name}`);
                    const option = document.createElement('option');
                    option.value = iface.name;
                    const state = iface.is_up ? 'up' : 'down';
                    option.textContent = `${iface.name} (${state})`;
                    select.appendChild(option);
                    debugLog(`Added option: ${option.textContent}`);
                });
                
                debugLog(`Total options added: ${select.options.length}`);
                
                if (interfaces.length > 0) {
                    select.value = interfaces[0].name;
                    debugLog(`Selected first interface: ${interfaces[0].name}`);
                }
                
            } catch (e) {
                debugLog(`Failed to load interfaces: ${e.message}`);
            }
        }
        
        // Start debugging when page loads
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('DOM loaded, starting interface loading');
            loadInterfaces();
        });
    </script>
</body>
</html>